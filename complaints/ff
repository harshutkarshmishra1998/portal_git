<script>
    let mobileOtpCode, emailOtpCode;
    let mobileVerifiedStatus = 0;
    let emailVerifiedStatus = 0;

    // Function to generate a random 6-digit OTP as a string.
    function generateOtp() {
        return Math.floor(100000 + Math.random() * 900000).toString();
    }

    // Mobile Verification: Generate OTP and send SMS via backend.
    document.getElementById("verifyMobileBtn").addEventListener("click", function() {
        const mobileNumber = document.getElementById("mobile_number").value.trim();
        if (mobileNumber === "") {
            alert("Please enter your mobile number before verifying.");
            return;
        }
        mobileOtpCode = generateOtp();

        // Call backend to send SMS (sendSMS.php should call sendSMS($recipient, "Your OTP is: $otp"))
        fetch('sendSMS.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ recipient: mobileNumber, otp: mobileOtpCode })
        })
        .then(response => response.json())
        .then(data => {
            console.log("Data received from sendSMS.php:", data);
        })
        .catch(error => {
            console.error("Error sending SMS:", error);
        });
    });

    // Email Verification: Generate OTP and send email via backend.
    document.getElementById("verifyEmailBtn").addEventListener("click", function() {
        const emailAddress = document.getElementById("email").value.trim();
        if (emailAddress === "") {
            alert("Please enter your email before verifying.");
            return;
        }
        emailOtpCode = generateOtp();

        // Call backend to send email (sendMail.php should call sendMail($toEmail, $toName, $subject, $message))
        fetch('sendMail.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                toEmail: emailAddress,
                toName: "", // Add a name if you have one, or leave empty.
                subject: "OTP Verification",
                message: "Your OTP is: " + emailOtpCode
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                console.log("Email sent successfully");
                document.getElementById("emailOtpContainer").style.display = "block";
            } else {
                alert("Failed to send Email OTP. Please try again.");
            }
        })
        .catch(error => {
            console.error("Error sending email:", error);
            alert("Error sending Email OTP. Please try again.");
        });
    });

    // Submit Mobile OTP Verification
    document.getElementById("submitMobileOtp").addEventListener("click", function() {
        const enteredOtp = document.getElementById("mobileOtp").value.trim();
        if (enteredOtp === "") {
            alert("OTP cannot be blank.");
            return;
        }
        if (enteredOtp === mobileOtpCode) {
            const container = document.getElementById("mobileOtpContainer");
            container.classList.add("fade-out");
            setTimeout(() => {
                container.style.display = "none";
                document.getElementById("verifyMobileBtn").textContent = "Verified";
                document.getElementById("verifyMobileBtn").disabled = true;
                mobileVerifiedStatus = 1;
                console.log("Mobile verification status:", mobileVerifiedStatus);
            }, 500);
        } else {
            alert("Incorrect OTP. Please try again.");
        }
    });

    // Submit Email OTP Verification
    document.getElementById("submitEmailOtp").addEventListener("click", function() {
        const enteredOtp = document.getElementById("emailOtp").value.trim();
        if (enteredOtp === "") {
            alert("OTP cannot be blank.");
            return;
        }
        if (enteredOtp === emailOtpCode) {
            const container = document.getElementById("emailOtpContainer");
            container.classList.add("fade-out");
            setTimeout(() => {
                container.style.display = "none";
                document.getElementById("verifyEmailBtn").textContent = "Verified";
                document.getElementById("verifyEmailBtn").disabled = true;
                emailVerifiedStatus = 1;
                console.log("Email verification status:", emailVerifiedStatus);
            }, 500);
        } else {
            alert("Incorrect OTP. Please try again.");
        }
    });
</script>